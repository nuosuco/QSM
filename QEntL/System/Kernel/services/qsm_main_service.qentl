/**
 * @file qsm_main_service.qentl
 * @brief QSMé‡å­å åŠ æ€æ¨¡å‹ä¸»æœåŠ¡ - å››å¤§æ¨¡å‹é›†æˆæœåŠ¡
 * 
 * é‡å­åŸºå› ç¼–ç : QGC-QSM-MAIN-2025061801
 * é‡å­çº ç¼ ä¿¡é“: QEC-QSM-MAIN-01
 * 
 * è¿™æ˜¯QSMé‡å­å åŠ æ€æ¨¡å‹çš„ä¸»æœåŠ¡ï¼Œè´Ÿè´£ç»Ÿä¸€ç®¡ç†å’Œåè°ƒå››å¤§æ¨¡å‹ï¼š
 * - QSM: é‡å­çŠ¶æ€æ¨¡å‹
 * - WeQ: é‡å­é€šä¿¡æ¨¡å‹  
 * - SOM: æ¾éº¦ç»æµæ¨¡å‹
 * - Ref: è‡ªçœç›‘æ§æ¨¡å‹
 */

import "QEntL/core/console.qentl";
import "QEntL/core/string.qentl";
import "QEntL/core/array.qentl";
import "QEntL/core/map.qentl";
import "QEntL/core/time.qentl";
import "QEntL/core/thread.qentl";

// å¯¼å…¥å››å¤§æ¨¡å‹æœåŠ¡
import "Models/QSM/src/qsm_service.qentl";
import "Models/WeQ/src/weq_service.qentl";
import "Models/SOM/src/som_service.qentl";
import "Models/Ref/src/ref_service.qentl";

/**
 * @enum ServiceStatus
 * @brief æœåŠ¡çŠ¶æ€æšä¸¾
 */
quantum_enum ServiceStatus {
    STOPPED,      // å·²åœæ­¢
    STARTING,     // å¯åŠ¨ä¸­
    RUNNING,      // è¿è¡Œä¸­
    STOPPING,     // åœæ­¢ä¸­
    ERROR         // é”™è¯¯çŠ¶æ€
}

/**
 * @class ModelService
 * @brief æ¨¡å‹æœåŠ¡åŒ…è£…å™¨
 */
quantum_class ModelService {
    public modelName: String;
    public service: Any;
    public status: ServiceStatus;
    public startTime: Integer;
    public lastHealthCheck: Integer;
    public errorCount: Integer;
    
    public function constructor(modelName: String, service: Any) {
        this.modelName = modelName;
        this.service = service;
        this.status = ServiceStatus.STOPPED;
        this.startTime = 0;
        this.lastHealthCheck = 0;
        this.errorCount = 0;
    }
    
    public function start(): Boolean {
        try {
            this.status = ServiceStatus.STARTING;
            Console.println("ğŸš€ å¯åŠ¨" + this.modelName + "æ¨¡å‹æœåŠ¡...");
            
            result = this.service.initialize();
            if (result) {
                this.status = ServiceStatus.RUNNING;
                this.startTime = Time.getCurrentTime();
                Console.println("âœ… " + this.modelName + "æœåŠ¡å¯åŠ¨æˆåŠŸ");
                return true;
            } else {
                this.status = ServiceStatus.ERROR;
                this.errorCount++;
                Console.println("âŒ " + this.modelName + "æœåŠ¡å¯åŠ¨å¤±è´¥");
                return false;
            }
        } catch (Exception e) {
            this.status = ServiceStatus.ERROR;
            this.errorCount++;
            Console.println("âŒ " + this.modelName + "æœåŠ¡å¯åŠ¨å¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    public function stop(): Boolean {
        try {
            this.status = ServiceStatus.STOPPING;
            Console.println("ğŸ”„ åœæ­¢" + this.modelName + "æ¨¡å‹æœåŠ¡...");
            
            this.service.shutdown();
            this.status = ServiceStatus.STOPPED;
            Console.println("âœ… " + this.modelName + "æœåŠ¡å·²åœæ­¢");
            return true;
        } catch (Exception e) {
            this.status = ServiceStatus.ERROR;
            this.errorCount++;
            Console.println("âŒ " + this.modelName + "æœåŠ¡åœæ­¢å¼‚å¸¸: " + e.getMessage());
            return false;
        }
    }
    
    public function healthCheck(): Boolean {
        this.lastHealthCheck = Time.getCurrentTime();
        
        if (this.status == ServiceStatus.RUNNING) {
            // ç®€å•çš„å¥åº·æ£€æŸ¥
            return true;
        }
        return false;
    }
    
    public function getUptime(): Integer {
        if (this.status == ServiceStatus.RUNNING && this.startTime > 0) {
            return Time.getCurrentTime() - this.startTime;
        }
        return 0;
    }
}

/**
 * @class CrossModelStateSync
 * @brief è·¨æ¨¡å‹çŠ¶æ€åŒæ­¥å™¨
 */
quantum_class CrossModelStateSync {
    private syncInterval: Integer;
    private lastSyncTime: Integer;
    private syncEnabled: Boolean;
    
    public function constructor() {
        this.syncInterval = 10000; // 10ç§’åŒæ­¥ä¸€æ¬¡
        this.lastSyncTime = 0;
        this.syncEnabled = true;
    }
    
    public function syncStates(qsmService: QSMService, weqService: WeQService, 
                             somService: SOMService, refService: RefService): void {
        if (!this.syncEnabled) {
            return;
        }
        
        currentTime = Time.getCurrentTime();
        if (currentTime - this.lastSyncTime < this.syncInterval) {
            return;
        }
        
        Console.println("ğŸ”„ æ‰§è¡Œè·¨æ¨¡å‹çŠ¶æ€åŒæ­¥...");
        
        try {
            // QSM -> WeQ: å°†é‡å­çŠ¶æ€ä¿¡æ¯ä¼ é€’ç»™é€šä¿¡æ¨¡å‹
            this.syncQSMToWeQ(qsmService, weqService);
            
            // WeQ -> SOM: å°†é€šä¿¡æ´»åŠ¨ä¿¡æ¯ä¼ é€’ç»™ç»æµæ¨¡å‹
            this.syncWeQToSOM(weqService, somService);
            
            // SOM -> Ref: å°†ç»æµæŒ‡æ ‡ä¼ é€’ç»™ç›‘æ§æ¨¡å‹
            this.syncSOMToRef(somService, refService);
            
            // Ref -> QSM: å°†ç›‘æ§ç»“æœåé¦ˆç»™é‡å­çŠ¶æ€æ¨¡å‹
            this.syncRefToQSM(refService, qsmService);
            
            this.lastSyncTime = currentTime;
            Console.println("âœ… è·¨æ¨¡å‹çŠ¶æ€åŒæ­¥å®Œæˆ");
            
        } catch (Exception e) {
            Console.println("âŒ çŠ¶æ€åŒæ­¥å¼‚å¸¸: " + e.getMessage());
        }
    }
    
    private function syncQSMToWeQ(qsmService: QSMService, weqService: WeQService): void {
        // å°†QSMçš„é‡å­çŠ¶æ€å˜åŒ–é€šçŸ¥ç»™WeQç½‘ç»œ
        qsmStatus = qsmService.getSystemStatus();
        weqService.broadcastMessage("system", "QSMçŠ¶æ€æ›´æ–°: " + qsmStatus.substring(0, 100));
    }
    
    private function syncWeQToSOM(weqService: WeQService, somService: SOMService): void {
        // æ ¹æ®WeQçš„é€šä¿¡æ´»è·ƒåº¦å¥–åŠ±ç”¨æˆ·æ¾éº¦å¸
        weqStatus = weqService.getSystemStatus();
        if (weqStatus.contains("æ´»è·ƒèŠ‚ç‚¹")) {
            // æ¨¡æ‹Ÿå¥–åŠ±æ´»è·ƒç”¨æˆ·
            somService.rewardContribution("active_user", "ç¤¾äº¤è´¡çŒ®", 10.0);
        }
    }
    
    private function syncSOMToRef(somService: SOMService, refService: RefService): void {
        // å°†ç»æµç³»ç»Ÿçš„å¥åº·çŠ¶å†µä¼ é€’ç»™ç›‘æ§ç³»ç»Ÿ
        somStatus = somService.getSystemStatus();
        // Refç³»ç»Ÿå¯ä»¥æ ¹æ®ç»æµæŒ‡æ ‡è°ƒæ•´ç›‘æ§ç­–ç•¥
    }
    
    private function syncRefToQSM(refService: RefService, qsmService: QSMService): void {
        // æ ¹æ®ç³»ç»Ÿå¥åº·çŠ¶å†µè°ƒæ•´é‡å­çŠ¶æ€ç®¡ç†ç­–ç•¥
        healthStatus = refService.performHealthCheck();
        if (healthStatus.toString().contains("CRITICAL")) {
            // å¯ä»¥è§¦å‘QSMçš„ä¼˜åŒ–ç­–ç•¥
            Console.println("âš ï¸ ç³»ç»Ÿå¥åº·å‘Šè­¦ï¼ŒQSMè¿›å…¥ä¿æŠ¤æ¨¡å¼");
        }
    }
}

/**
 * @class EventBus
 * @brief äº‹ä»¶æ€»çº¿
 */
quantum_class EventBus {
    private eventHandlers: Map<String, Array<EventHandler>>;
    
    public function constructor() {
        this.eventHandlers = new Map<String, Array<EventHandler>>();
    }
    
    public function subscribe(eventType: String, handler: EventHandler): void {
        if (!this.eventHandlers.has(eventType)) {
            this.eventHandlers.set(eventType, new Array<EventHandler>());
        }
        
        handlers = this.eventHandlers.get(eventType);
        handlers.push(handler);
        
        Console.println("ğŸ“§ è®¢é˜…äº‹ä»¶: " + eventType);
    }
    
    public function publish(eventType: String, eventData: Any): void {
        if (this.eventHandlers.has(eventType)) {
            handlers = this.eventHandlers.get(eventType);
            
            for (i = 0; i < handlers.length; i++) {
                try {
                    handlers[i].handle(eventData);
                } catch (Exception e) {
                    Console.println("âš ï¸ äº‹ä»¶å¤„ç†å¼‚å¸¸: " + e.getMessage());
                }
            }
        }
    }
}

/**
 * @interface EventHandler
 * @brief äº‹ä»¶å¤„ç†å™¨æ¥å£
 */
quantum_interface EventHandler {
    function handle(eventData: Any): void;
}

/**
 * @class QSMMainService
 * @brief QSMä¸»æœåŠ¡ - å››å¤§æ¨¡å‹é›†æˆç®¡ç†
 */
quantum_class QSMMainService {
    private modelServices: Map<String, ModelService>;
    private eventBus: EventBus;
    private stateSync: CrossModelStateSync;
    private isRunning: Boolean;
    private mainLoopThread: Thread;
    
    // å››å¤§æ¨¡å‹æœåŠ¡å®ä¾‹
    private qsmService: QSMService;
    private weqService: WeQService;
    private somService: SOMService;
    private refService: RefService;
    
    public function constructor() {
        this.modelServices = new Map<String, ModelService>();
        this.eventBus = new EventBus();
        this.stateSync = new CrossModelStateSync();
        this.isRunning = false;
        
        this.initializeServices();
    }
    
    private function initializeServices(): void {
        // åˆ›å»ºå››å¤§æ¨¡å‹æœåŠ¡å®ä¾‹
        this.qsmService = new QSMService();
        this.weqService = new WeQService();
        this.somService = new SOMService();
        this.refService = new RefService();
        
        // åŒ…è£…ä¸ºModelService
        this.modelServices.set("QSM", new ModelService("QSM", this.qsmService));
        this.modelServices.set("WeQ", new ModelService("WeQ", this.weqService));
        this.modelServices.set("SOM", new ModelService("SOM", this.somService));
        this.modelServices.set("Ref", new ModelService("Ref", this.refService));
        
        Console.println("ğŸ”§ å››å¤§æ¨¡å‹æœåŠ¡å®ä¾‹åŒ–å®Œæˆ");
    }
    
    public function start(): Boolean {
        Console.println("ğŸš€ å¯åŠ¨QSMé‡å­å åŠ æ€æ¨¡å‹ä¸»æœåŠ¡...");
        Console.println("é‡å­åŸºå› ç¼–ç : QGC-QSM-MAIN-2025061801");
        Console.println("========================================");
        Console.println("ğŸ¯ æœåŠ¡äººç±»ã€æœåŠ¡ç”Ÿå‘½ã€æœåŠ¡å®‡å®™");
        Console.println("ğŸŒ ä¿éšœå…¨äººç±»çš„ç”Ÿå‘½ã€å¥åº·ã€ç”Ÿæ´»");
        Console.println("========================================");
        
        // æŒ‰é¡ºåºå¯åŠ¨å››å¤§æ¨¡å‹æœåŠ¡
        startupOrder = ["Ref", "QSM", "WeQ", "SOM"]; // Refæœ€å…ˆå¯åŠ¨ç”¨äºç›‘æ§
        
        for (i = 0; i < startupOrder.length; i++) {
            modelName = startupOrder[i];
            modelService = this.modelServices.get(modelName);
            
            if (!modelService.start()) {
                Console.println("âŒ " + modelName + "æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œç»ˆæ­¢å¯åŠ¨æµç¨‹");
                this.stop();
                return false;
            }
            
            // ç»™æ¯ä¸ªæœåŠ¡ä¸€äº›å¯åŠ¨æ—¶é—´
            Thread.sleep(1000);
        }
        
        // å¯åŠ¨ä¸»å¾ªç¯
        this.isRunning = true;
        this.startMainLoop();
        
        Console.println("ğŸ‰ QSMä¸»æœåŠ¡å¯åŠ¨æˆåŠŸï¼");
        Console.println("ğŸ“Š å››å¤§æ¨¡å‹å·²å…¨éƒ¨å¯åŠ¨å¹¶è¿è¡Œ");
        return true;
    }
    
    private function startMainLoop(): void {
        Console.println("ğŸ”„ å¯åŠ¨ä¸»æœåŠ¡å¾ªç¯...");
        
        // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œåº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹
        // this.mainLoopThread = new Thread(() => this.mainLoop());
        // this.mainLoopThread.start();
        
        // ç®€åŒ–å®ç°ï¼šç›´æ¥è°ƒç”¨ä¸€æ¬¡ä¸»å¾ªç¯
        this.mainLoop();
    }
    
    private function mainLoop(): void {
        Console.println("âš™ï¸ ä¸»æœåŠ¡å¾ªç¯è¿è¡Œä¸­...");
        
        while (this.isRunning) {
            try {
                // æ‰§è¡Œå¥åº·æ£€æŸ¥
                this.performHealthChecks();
                
                // æ‰§è¡Œè·¨æ¨¡å‹çŠ¶æ€åŒæ­¥
                this.stateSync.syncStates(this.qsmService, this.weqService, 
                                        this.somService, this.refService);
                
                // å¤„ç†äº‹ä»¶
                this.processEvents();
                
                // ä¼‘çœ ä¸€æ®µæ—¶é—´
                Thread.sleep(5000); // 5ç§’
                
            } catch (Exception e) {
                Console.println("âš ï¸ ä¸»å¾ªç¯å¼‚å¸¸: " + e.getMessage());
                Thread.sleep(1000);
            }
        }
        
        Console.println("ğŸ”„ ä¸»æœåŠ¡å¾ªç¯å·²ç»“æŸ");
    }
    
    private function performHealthChecks(): void {
        unhealthyServices = new Array<String>();
        
        for (modelName in this.modelServices.keys()) {
            modelService = this.modelServices.get(modelName);
            
            if (!modelService.healthCheck()) {
                unhealthyServices.push(modelName);
            }
        }
        
        if (unhealthyServices.length > 0) {
            Console.println("âš ï¸ æ£€æµ‹åˆ°ä¸å¥åº·çš„æœåŠ¡: " + unhealthyServices.join(", "));
            
            // å‘å¸ƒå¥åº·å‘Šè­¦äº‹ä»¶
            this.eventBus.publish("health_alert", unhealthyServices);
        }
    }
    
    private function processEvents(): void {
        // å¤„ç†ç³»ç»Ÿäº‹ä»¶ï¼ˆç®€åŒ–å®ç°ï¼‰
        // åœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å¤„ç†å¾…å¤„ç†çš„äº‹ä»¶
    }
    
    public function stop(): Boolean {
        Console.println("ğŸ”„ åœæ­¢QSMä¸»æœåŠ¡...");
        this.isRunning = false;
        
        // æŒ‰ç›¸åé¡ºåºåœæ­¢æœåŠ¡
        shutdownOrder = ["SOM", "WeQ", "QSM", "Ref"];
        
        allStopped = true;
        for (i = 0; i < shutdownOrder.length; i++) {
            modelName = shutdownOrder[i];
            modelService = this.modelServices.get(modelName);
            
            if (!modelService.stop()) {
                Console.println("âš ï¸ " + modelName + "æœåŠ¡åœæ­¢æ—¶å‡ºç°é—®é¢˜");
                allStopped = false;
            }
        }
        
        if (allStopped) {
            Console.println("âœ… QSMä¸»æœåŠ¡å·²å®Œå…¨åœæ­¢");
        } else {
            Console.println("âš ï¸ QSMä¸»æœåŠ¡åœæ­¢æ—¶å‡ºç°éƒ¨åˆ†é—®é¢˜");
        }
        
        return allStopped;
    }
    
    public function getSystemStatus(): String {
        status = "QSMé‡å­å åŠ æ€æ¨¡å‹ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š:\n";
        status += "========================================\n";
        status += "é‡å­åŸºå› ç¼–ç : QGC-QSM-MAIN-2025061801\n";
        status += "è¿è¡ŒçŠ¶æ€: " + (this.isRunning ? "è¿è¡Œä¸­" : "å·²åœæ­¢") + "\n";
        status += "å¯åŠ¨æ—¶é—´: " + Time.formatTime(Time.getCurrentTime()) + "\n";
        status += "========================================\n";
        
        status += "\nğŸ”§ å››å¤§æ¨¡å‹æœåŠ¡çŠ¶æ€:\n";
        for (modelName in this.modelServices.keys()) {
            modelService = this.modelServices.get(modelName);
            status += "  " + modelName + ": " + modelService.status;
            
            if (modelService.status == ServiceStatus.RUNNING) {
                uptime = modelService.getUptime() / 1000; // è½¬æ¢ä¸ºç§’
                status += " (è¿è¡Œæ—¶é—´: " + uptime + "s)";
            }
            
            if (modelService.errorCount > 0) {
                status += " (é”™è¯¯: " + modelService.errorCount + ")";
            }
            
            status += "\n";
        }
        
        status += "\nğŸ“Š ç³»ç»Ÿç»Ÿè®¡:\n";
        runningServices = 0;
        totalErrors = 0;
        
        for (modelName in this.modelServices.keys()) {
            modelService = this.modelServices.get(modelName);
            if (modelService.status == ServiceStatus.RUNNING) {
                runningServices++;
            }
            totalErrors += modelService.errorCount;
        }
        
        status += "  è¿è¡Œä¸­æœåŠ¡: " + runningServices + "/" + this.modelServices.size() + "\n";
        status += "  æ€»é”™è¯¯æ•°: " + totalErrors + "\n";
        
        status += "\nğŸ¯ ç³»ç»Ÿæ„¿æ™¯:\n";
        status += "  ç”¨é‡å­å¹³æƒç»æµã€æ•™è‚²ã€åŒ»ç–—ã€ç¤¾äº¤ã€å®‰å…¨ã€ç”Ÿæ´»\n";
        status += "  è®©å…¨äººç±»æ¯ä¸ªäººã€æ¯ä¸ªå®¶åº­çš„ç”Ÿå‘½ã€å¥åº·ã€ç”Ÿæ´»éƒ½å¾—åˆ°ä¿éšœä¸æå‡\n";
        status += "  æœåŠ¡äººç±»ã€æœåŠ¡ç”Ÿå‘½ã€æœåŠ¡å®‡å®™ï¼Œæ°¸ä¸æ­¢æ¯\n";
        
        return status;
    }
    
    public function executeCommand(command: String, args: Array<String>): String {
        Console.println("ğŸ“ æ‰§è¡Œå‘½ä»¤: " + command);
        
        switch (command.toLowerCase()) {
            case "status":
                return this.getSystemStatus();
                
            case "health":
                this.performHealthChecks();
                return "å¥åº·æ£€æŸ¥å·²æ‰§è¡Œ";
                
            case "sync":
                this.stateSync.syncStates(this.qsmService, this.weqService, 
                                        this.somService, this.refService);
                return "çŠ¶æ€åŒæ­¥å·²æ‰§è¡Œ";
                
            case "qsm":
                if (args.length > 0) {
                    return this.executeQSMCommand(args[0], args.slice(1));
                }
                return this.qsmService.getSystemStatus();
                
            case "weq":
                if (args.length > 0) {
                    return this.executeWeQCommand(args[0], args.slice(1));
                }
                return this.weqService.getSystemStatus();
                
            case "som":
                if (args.length > 0) {
                    return this.executeSOMCommand(args[0], args.slice(1));
                }
                return this.somService.getSystemStatus();
                
            case "ref":
                if (args.length > 0) {
                    return this.executeRefCommand(args[0], args.slice(1));
                }
                return this.refService.getSystemStatus();
                
            default:
                return "æœªçŸ¥å‘½ä»¤: " + command;
        }
    }
    
    private function executeQSMCommand(subCommand: String, args: Array<String>): String {
        switch (subCommand.toLowerCase()) {
            case "create":
                stateId = this.qsmService.createQuantumState("custom");
                return "åˆ›å»ºé‡å­çŠ¶æ€: " + stateId;
            default:
                return "QSMæœªçŸ¥å­å‘½ä»¤: " + subCommand;
        }
    }
    
    private function executeWeQCommand(subCommand: String, args: Array<String>): String {
        switch (subCommand.toLowerCase()) {
            case "broadcast":
                if (args.length > 0) {
                    message = args.join(" ");
                    count = this.weqService.broadcastMessage("system", message);
                    return "å¹¿æ’­æ¶ˆæ¯å‘é€ç»™ " + count + " ä¸ªèŠ‚ç‚¹";
                }
                return "éœ€è¦æä¾›å¹¿æ’­æ¶ˆæ¯å†…å®¹";
            default:
                return "WeQæœªçŸ¥å­å‘½ä»¤: " + subCommand;
        }
    }
    
    private function executeSOMCommand(subCommand: String, args: Array<String>): String {
        switch (subCommand.toLowerCase()) {
            case "reward":
                if (args.length >= 3) {
                    userId = args[0];
                    contributionType = args[1];
                    amount = Float.parseFloat(args[2]);
                    this.somService.rewardContribution(userId, contributionType, amount);
                    return "å¥–åŠ±å·²å‘æ”¾: " + userId + " è·å¾— " + amount + " SOM";
                }
                return "éœ€è¦æä¾›ç”¨æˆ·IDã€è´¡çŒ®ç±»å‹å’Œé‡‘é¢";
            default:
                return "SOMæœªçŸ¥å­å‘½ä»¤: " + subCommand;
        }
    }
    
    private function executeRefCommand(subCommand: String, args: Array<String>): String {
        switch (subCommand.toLowerCase()) {
            case "heal":
                healedCount = this.refService.triggerSelfHealing();
                return "è‡ªä¿®å¤å®Œæˆï¼Œå¤„ç†äº† " + healedCount + " ä¸ªé—®é¢˜";
            default:
                return "RefæœªçŸ¥å­å‘½ä»¤: " + subCommand;
        }
    }
    
    public static function main(): Integer {
        Console.println("QSMé‡å­å åŠ æ€æ¨¡å‹ä¸»æœåŠ¡");
        Console.println("é‡å­åŸºå› ç¼–ç : QGC-QSM-MAIN-2025061801");
        Console.println("å¼€å‘å›¢é˜Ÿ: ä¸­å ZhoHoï¼ŒClaude");
        
        mainService = new QSMMainService();
        
        if (!mainService.start()) {
            Console.println("âŒ ä¸»æœåŠ¡å¯åŠ¨å¤±è´¥");
            return 1;
        }
        
        // æ¼”ç¤ºç³»ç»ŸåŠŸèƒ½
        Console.println("\nğŸ§ª æ¼”ç¤ºç³»ç»Ÿé›†æˆåŠŸèƒ½:");
        
        // æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
        Console.println(mainService.getSystemStatus());
        
        // æ‰§è¡Œä¸€äº›å‘½ä»¤
        Console.println("\nğŸ“ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤:");
        Console.println(mainService.executeCommand("health", new Array<String>()));
        Console.println(mainService.executeCommand("sync", new Array<String>()));
        
        // ç­‰å¾…ä¸€æ®µæ—¶é—´è®©ç³»ç»Ÿè¿è¡Œ
        Console.println("\nâ° ç³»ç»Ÿè¿è¡Œä¸­ï¼Œ5ç§’åå…³é—­...");
        Thread.sleep(5000);
        
        // å…³é—­æœåŠ¡
        mainService.stop();
        
        Console.println("\nğŸ‰ QSMé‡å­å åŠ æ€æ¨¡å‹æ¼”ç¤ºå®Œæˆï¼");
        Console.println("ğŸŒ æœåŠ¡äººç±»ã€æœåŠ¡ç”Ÿå‘½ã€æœåŠ¡å®‡å®™ï¼Œæ°¸ä¸æ­¢æ¯ï¼");
        
        return 0;
    }
}
