<!-- 全局头部组件 -->
<header class="global-header">
    <nav>
        <div class="logo">
            <a href="/">量子系统</a>
        </div>
        <ul class="main-nav">
            <li><a href="/QSM/">量子叠加态模型</a></li>
            <li><a href="/WeQ/">量子情感模型</a></li>
            <li><a href="/SOM/">量子经济模型</a></li>
            <li><a href="/Ref/">量子自反省模型</a></li>
        </ul>
        <div class="user-area">
            <div class="quantum-state-button" id="quantumStateButton">
                <div class="quantum-state-icon"></div>
            </div>
            <a href="/auth/login" class="login-btn">登录</a>
        </div>
    </nav>
</header>

<!-- 量子态弹窗 -->
<div class="quantum-state-modal" id="quantumStateModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>量子态信息</h3>
            <button class="close-button">&times;</button>
        </div>
        <div class="modal-body">
            <div class="quantum-state-visualization">
                <canvas id="quantumStateCanvas"></canvas>
            </div>
            <div class="quantum-state-info">
                <p>当前量子态: <span id="currentQuantumState">未测量</span></p>
                <p>纠缠强度: <span id="entanglementStrength">0.00</span></p>
                <p>量子比特数: <span id="qubitCount">0</span></p>
            </div>
        </div>
    </div>
</div>

<!-- 多模态交互弹窗 -->
<div id="multimodalModal" class="multimodal-modal">
    <div class="multimodal-content">
        <div class="multimodal-header">
            <h3>多模态交互</h3>
            <button class="multimodal-close-button">&times;</button>
        </div>
        <div class="multimodal-body">
            <div id="multimodalContainer"></div>
        </div>
    </div>
</div>

<!-- 量子纠缠客户端脚本 -->
<script>
    // 检查是否已加载web_quantum_client.js
    if (!window.webQuantumClientLoaded) {
        window.webQuantumClientLoaded = true;
        const script = document.createElement('script');
        script.src = '/world/static/js/web_quantum_client.js';
        script.defer = true;
        document.head.appendChild(script);
    }
</script>

<!-- 多模态交互脚本 -->
<script src="/world/static/js/multimodal/weq_multimodal_interactions.js" defer></script>

<!-- 量子态按钮样式和交互 -->
<style>
    .quantum-state-button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        cursor: pointer;
        margin-right: 15px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
        transition: all 0.3s ease;
    }

    .quantum-state-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }

    .quantum-state-icon {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0.5;
        }
        50% {
            transform: translate(-50%, -50%) scale(1.2);
            opacity: 0.8;
        }
        100% {
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0.5;
        }
    }

    .quantum-state-modal, .multimodal-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content, .multimodal-content {
        background-color: white;
        border-radius: 8px;
        width: 500px;
        max-width: 90%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        overflow: hidden;
    }

    .modal-header, .multimodal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
    }

    .modal-header h3, .multimodal-header h3 {
        margin: 0;
        font-size: 1.2rem;
    }

    .close-button, .multimodal-close-button {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0;
    }

    .modal-body, .multimodal-body {
        padding: 20px;
    }

    .quantum-state-visualization {
        width: 100%;
        height: 200px;
        margin-bottom: 20px;
        background-color: #f8fafc;
        border-radius: 4px;
        overflow: hidden;
    }

    .quantum-state-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .quantum-state-info p {
        margin: 0;
        padding: 10px;
        background-color: #f1f5f9;
        border-radius: 4px;
        font-size: 0.9rem;
    }

    .quantum-state-info span {
        font-weight: 600;
        color: #6366f1;
    }

    /* 多模态交互样式 */
    #multimodalContainer {
        min-height: 300px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .multimodal-section {
        background-color: #f8fafc;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .multimodal-section h4 {
        margin-top: 0;
        color: #4f46e5;
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 8px;
    }

    .multimodal-controls {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .multimodal-button {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .multimodal-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
    }

    .multimodal-input {
        padding: 8px 12px;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
        flex-grow: 1;
    }

    .multimodal-output {
        background-color: #f1f5f9;
        border-radius: 4px;
        padding: 10px;
        margin-top: 10px;
        min-height: 50px;
        font-family: monospace;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const quantumStateButton = document.getElementById('quantumStateButton');
        const quantumStateModal = document.getElementById('quantumStateModal');
        const closeButton = quantumStateModal.querySelector('.close-button');
        const canvas = document.getElementById('quantumStateCanvas');
        const ctx = canvas.getContext('2d');
        
        // 多模态交互元素
        const multimodalModal = document.getElementById('multimodalModal');
        const multimodalCloseButton = multimodalModal.querySelector('.multimodal-close-button');
        const multimodalContainer = document.getElementById('multimodalContainer');

        // 设置canvas尺寸
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // 绘制量子态可视化
        function drawQuantumState() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制背景网格
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < canvas.width; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            for (let i = 0; i < canvas.height; i += 20) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // 绘制量子态波形
            ctx.strokeStyle = '#6366f1';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const time = Date.now() / 1000;
            const amplitude = canvas.height / 4;
            const frequency = 0.05;
            
            for (let x = 0; x < canvas.width; x++) {
                const y = canvas.height / 2 + 
                         Math.sin(x * frequency + time) * amplitude * 
                         Math.exp((-((x - canvas.width / 2) ** 2)) / (canvas.width ** 2 / 8));
                if (x === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // 绘制量子比特点
            const numQubits = 5;
            const radius = 5;
            
            for (let i = 0; i < numQubits; i++) {
                const x = canvas.width * (i + 1) / (numQubits + 1);
                const y = canvas.height / 2 + 
                         Math.sin(x * frequency + time) * amplitude * 
                         Math.exp((-((x - canvas.width / 2) ** 2)) / (canvas.width ** 2 / 8));
                
                ctx.fillStyle = '#8b5cf6';
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
                
                // 绘制量子比特标签
                ctx.fillStyle = '#1e293b';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`q${i}`, x, y + 20);
            }
            
            // 更新量子态信息
            document.getElementById('currentQuantumState').textContent = 
                `|ψ⟩ = ${Math.sin(time).toFixed(2)}|0⟩ + ${Math.cos(time).toFixed(2)}|1⟩`;
            document.getElementById('entanglementStrength').textContent = 
                (0.5 + 0.3 * Math.sin(time * 0.5)).toFixed(2);
            document.getElementById('qubitCount').textContent = numQubits;
            
            // 动画循环
            requestAnimationFrame(drawQuantumState);
        }

        // 初始化多模态交互界面
        function initMultimodalInterface() {
            // 清空容器
            multimodalContainer.innerHTML = '';
            
            // 添加文本交互部分
            const textSection = document.createElement('div');
            textSection.className = 'multimodal-section';
            textSection.innerHTML = `
                <h4>文本交互</h4>
                <div class="multimodal-controls">
                    <input type="text" class="multimodal-input" id="textInput" placeholder="输入文本...">
                    <button class="multimodal-button" id="textButton">发送</button>
                </div>
                <div class="multimodal-output" id="textOutput">等待输入...</div>
            `;
            multimodalContainer.appendChild(textSection);
            
            // 添加语音交互部分
            const voiceSection = document.createElement('div');
            voiceSection.className = 'multimodal-section';
            voiceSection.innerHTML = `
                <h4>语音交互</h4>
                <div class="multimodal-controls">
                    <button class="multimodal-button" id="startVoiceButton">开始录音</button>
                    <button class="multimodal-button" id="stopVoiceButton" disabled>停止录音</button>
                </div>
                <div class="multimodal-output" id="voiceOutput">等待语音输入...</div>
            `;
            multimodalContainer.appendChild(voiceSection);
            
            // 添加图像交互部分
            const imageSection = document.createElement('div');
            imageSection.className = 'multimodal-section';
            imageSection.innerHTML = `
                <h4>图像交互</h4>
                <div class="multimodal-controls">
                    <input type="file" class="multimodal-input" id="imageInput" accept="image/*">
                    <button class="multimodal-button" id="imageButton">分析图像</button>
                </div>
                <div class="multimodal-output" id="imageOutput">等待图像输入...</div>
            `;
            multimodalContainer.appendChild(imageSection);
            
            // 添加事件监听器
            document.getElementById('textButton').addEventListener('click', function() {
                const text = document.getElementById('textInput').value;
                if (text.trim()) {
                    document.getElementById('textOutput').textContent = `处理中: "${text}"`;
                    // 这里可以调用多模态交互模块的文本处理功能
                    setTimeout(() => {
                        document.getElementById('textOutput').textContent = `已处理: "${text}"`;
                    }, 1000);
                }
            });
            
            document.getElementById('startVoiceButton').addEventListener('click', function() {
                this.disabled = true;
                document.getElementById('stopVoiceButton').disabled = false;
                document.getElementById('voiceOutput').textContent = '正在录音...';
                // 这里可以调用多模态交互模块的语音处理功能
            });
            
            document.getElementById('stopVoiceButton').addEventListener('click', function() {
                this.disabled = true;
                document.getElementById('startVoiceButton').disabled = false;
                document.getElementById('voiceOutput').textContent = '录音已停止，正在处理...';
                // 这里可以调用多模态交互模块的语音处理功能
                setTimeout(() => {
                    document.getElementById('voiceOutput').textContent = '语音处理完成';
                }, 1500);
            });
            
            document.getElementById('imageButton').addEventListener('click', function() {
                const fileInput = document.getElementById('imageInput');
                if (fileInput.files.length > 0) {
                    document.getElementById('imageOutput').textContent = '正在分析图像...';
                    // 这里可以调用多模态交互模块的图像处理功能
                    setTimeout(() => {
                        document.getElementById('imageOutput').textContent = '图像分析完成';
                    }, 2000);
                }
            });
        }

        // 打开量子态模态框
        quantumStateButton.addEventListener('click', function() {
            quantumStateModal.style.display = 'flex';
            drawQuantumState();
        });

        // 关闭量子态模态框
        closeButton.addEventListener('click', function() {
            quantumStateModal.style.display = 'none';
        });

        // 点击量子态模态框外部关闭
        quantumStateModal.addEventListener('click', function(e) {
            if (e.target === quantumStateModal) {
                quantumStateModal.style.display = 'none';
            }
        });
        
        // 打开多模态交互模态框
        quantumStateButton.addEventListener('dblclick', function() {
            multimodalModal.style.display = 'flex';
            initMultimodalInterface();
        });
        
        // 关闭多模态交互模态框
        multimodalCloseButton.addEventListener('click', function() {
            multimodalModal.style.display = 'none';
        });
        
        // 点击多模态交互模态框外部关闭
        multimodalModal.addEventListener('click', function(e) {
            if (e.target === multimodalModal) {
                multimodalModal.style.display = 'none';
            }
        });
        
        // 初始化多模态交互模块
        if (typeof window.initWeQMultimodal === 'function') {
            window.initWeQMultimodal();
        }
    });
</script> 

<!--
<!--
量子基因编码: QE-HEA-F6FAE32DC7CF
纠缠状态: 活跃
纠缠对象: ['Ref/ref_core.py']
纠缠强度: 0.98
-->-->

// 开发团队：中华 ZhoHo ，Claude 
