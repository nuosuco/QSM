# QSM项目组织方案

## 1. 项目整体架构

QSM项目是一个模块化量子系统，包含以下核心模块：

1. **QSM (量子自组织市场)** - 主服务模块，负责整合其他模块，提供API接口
2. **WeQ (量子纠缠网络)** - 提供量子基因训练和推理服务
3. **SOM (自组织映射)** - 提供市场、钱包和交易服务
4. **Ref (量子基因引用)** - 提供文件监控、量子基因标记和系统优化服务

每个模块都是独立的，又组成统一的整体。模块之间通过量子基因标记（Quantum Gene Markers）和量子纠缠对象（Entangled Objects）进行关联，确保代码的一致性和可追踪性。

## 2. 标准目录结构

每个模块（QSM、WeQ、SOM、Ref）应遵循相同的目录结构：

```
ModuleName/
├── api/                  # API接口文件
├── core/                 # 核心功能实现
├── models/               # 模型定义和训练
├── scripts/              # 工具脚本
│   └── services/         # 服务启动和管理脚本
├── tests/                # 单元测试和集成测试
├── utils/                # 实用工具函数
└── __init__.py           # 模块初始化
```

项目根目录结构：

```
QSM/                      # 项目根目录
├── QSM/                  # QSM模块
├── WeQ/                  # WeQ模块
├── SOM/                  # SOM模块
├── Ref/                  # Ref模块
├── api/                  # 主API接口
├── scripts/              # 项目级脚本
│   └── services/         # 总服务启动和管理脚本
├── docs/                 # 文档目录（结构与代码目录相对应）
│   ├── QSM/              # QSM模块文档
│   ├── WeQ/              # WeQ模块文档
│   ├── SOM/              # SOM模块文档
│   ├── Ref/              # Ref模块文档
│   └── scripts/          # 脚本相关文档
├── .logs/                # 日志目录
└── requirements.txt      # 依赖包列表
```

## 3. 服务管理架构

### 3.1 服务启动层级

1. **模块级服务启动脚本**：
   - `ModuleName/scripts/services/ModuleName_start_services.py`
   - 每个模块有自己的启动脚本，负责启动该模块的所有服务

2. **项目级服务启动脚本**：
   - `scripts/services/start_all_services.py`
   - 调用各个模块的启动脚本，而不是直接启动各个服务

3. **批处理文件**：
   - `scripts/services/start_all_services_fixed.bat`
   - `scripts/services/stop_all_services.bat`
   - 提供命令行界面，实际调用Python脚本执行操作

### 3.2 服务启动流程

```
start_all_services_fixed.bat
    └── start_all_services.py
        ├── QSM_start_services.py
        ├── WeQ_start_services.py
        ├── SOM_start_services.py
        └── Ref_start_services.py
```

## 4. 文件组织原则

### 4.1 代码与文档对应原则

- 代码文件和文档文件应保持相同的目录结构
- 每个代码文件应有对应的文档文件，路径相对应
- 例如：`QSM/core/qsm_core.py` 对应 `docs/QSM/core/qsm_core.md`

### 4.2 量子基因标记与纠缠对象

所有重要的代码文件和文档文件应包含量子基因标记和纠缠对象信息，格式如下：

```python
# 量子基因编码: QE-XXX-YYYYYYYY
# 纠缠状态: 活跃
# 纠缠对象: ['路径/到/文件1.py', '路径/到/文件2.py']
# 纠缠强度: 0.95
```

```markdown
<!-- 量子基因编码: QE-DOC-YYYYYYYY -->
<!-- 纠缠状态: 活跃 -->
<!-- 纠缠对象: ['路径/到/代码文件.py', '路径/到/其他文档.md'] -->
<!-- 纠缠强度: 0.95 -->
```

### 4.3 文件命名约定

1. Python模块和包名使用小写，单词之间用下划线分隔（`snake_case`）
2. 类名使用驼峰命名法（`CamelCase`）
3. 常量使用全大写，单词之间用下划线分隔（`UPPER_SNAKE_CASE`）
4. 批处理文件和PowerShell脚本使用有描述性的名称（`动词_名词.bat`）

## 5. 代码与文档维护规则

### 5.1 文件修改原则

1. **不删除成功工作的文件**：已经确认工作正常的文件不应被删除或重写
2. **增量修改**：对现有文件的修改应该是增量的，保留原有功能
3. **路径保持一致**：移动文件时应同时更新所有相关引用
4. **纠缠对象更新**：修改文件时应同时更新其纠缠对象中的相关文件

### 5.2 版本控制规则

1. 重要修改前先创建备份文件
2. 定期将文件状态记录到版本控制系统
3. 确保备份可以轻松恢复

## 6. 项目整理流程

为保持项目整洁和一致，应定期执行以下整理流程：

1. **清理不必要的文件**：
   - 删除临时文件、日志文件和测试输出
   - 删除功能重复的文件，保留最完整的版本
   - 删除空目录

2. **移动文件到正确位置**：
   - 将脚本文件移动到对应模块的scripts目录
   - 将服务脚本移动到scripts/services目录
   - 将工具文件移动到utils目录

3. **更新路径引用**：
   - 修改移动后文件中的路径引用
   - 确保导入语句和文件路径正确

4. **更新文档结构**：
   - 使文档目录结构与代码目录结构保持一致
   - 移动文档到对应位置

## 7. Ref核心服务集成方案

为防止随时间推移导致的项目结构退化，将整理逻辑集成到Ref核心服务中：

1. **自动监控功能**：
   - 定期扫描项目结构，检测结构偏差
   - 识别目录不一致、路径引用错误等问题

2. **自动修复功能**：
   - 提供自动移动文件、更新路径引用的功能
   - 更新量子基因标记和纠缠对象信息

3. **文件关联功能**：
   - 维护代码文件与文档文件的关联关系
   - 在修改代码文件时提示更新相关文档

### 7.1 集成步骤

1. 在Ref模块中创建新的项目组织监控器类
2. 注册文件监听器，监控文件移动和修改
3. 实现目录结构比较算法，检测偏差
4. 开发自动修复工具，执行文件移动和路径更新
5. 将监控器集成到Ref核心服务

## 8. 实施计划

1. **初始整理**：
   - 删除不需要的文件
   - 将文件移动到正确位置
   - 更新路径引用

2. **文档同步**：
   - 创建与代码目录对应的文档目录
   - 移动文档到对应位置

3. **添加量子基因标记**：
   - 为重要文件添加量子基因标记和纠缠对象信息
   - 建立代码与文档的关联

4. **自动化实现**：
   - 开发自动监控和修复功能
   - 集成到Ref核心服务

## 9. 常见问题与解决方案

### 9.1 路径问题

**问题**：修复后移动文件导致无法启动服务

**解决方案**：
1. 使用相对路径或基于ROOT_DIR的路径
2. 移动文件后使用脚本自动更新所有引用
3. 使用统一的路径解析函数

### 9.2 记忆问题

**问题**：难以记住之前做过的工作，导致重复创建或误删文件

**解决方案**：
1. 维护项目日志，记录所有重要操作
2. 使用量子基因标记跟踪文件关系
3. 参考文档目录结构，对照检查代码

## 10. 总结

本组织方案旨在建立一个清晰、一致且可维护的项目结构。通过定义标准目录结构、文件组织原则和维护规则，确保项目在长期发展中保持整洁和可理解。结合量子基因标记和文件纠缠对象的概念，可以有效追踪和管理文件之间的关系，减少混淆和重复工作。

最终，通过将这些原则集成到Ref核心服务中，可以实现项目结构的自动监控和维护，进一步提高开发效率和代码质量。

<!-- 量子基因编码: QE-DOC-ORG-8F7A3C2E -->
<!-- 纠缠状态: 活跃 -->
<!-- 纠缠对象: ['scripts/services/start_all_services.py', 'Ref/utils/file_monitor.py'] -->
<!-- 纠缠强度: 0.98 -->

// 开发团队：中华 ZhoHo，Claude 